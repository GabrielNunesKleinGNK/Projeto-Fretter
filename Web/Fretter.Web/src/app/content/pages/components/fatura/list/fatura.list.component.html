<!-- Filtro -->
<div class="row">
	<div class="col-xl-12">
		<m-portlet [options]="{headLarge: false}">
			<ng-container mPortletHeadTitle>
				<div class="m-portlet__head-title">
					<h3 class="m-portlet__head-text">
						<span translate="y">Faturas | Filtros</span>
					</h3>
				</div>
			</ng-container>
			<ng-container mPortletBody>
				<div class="filtro">
					<div class="row">
						<div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 ">
							<label>Periodo</label>
							<ng-select [items]="periodos" bindLabel="nome" bindValue="id" placeholder=""
								ng-options="g.descricao for g in periodos track by g.id" [(ngModel)]="periodoId"
								(change)="filtroPeriodoChange($event)" appendTo="body">
							</ng-select>
						</div>
						<div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 ">
							<label>Transportador</label>
							<ng-select [items]="transportadores" bindLabel="transportadorNome" bindValue="id"
								placeholder="Todos" [(ngModel)]="filtro.transportadorId"
								(change)="filtroTransportadorChange($event)" appendTo="body">
							</ng-select>
						</div>
						<div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 ">
							<label>Status</label>
							<ng-select [items]="status" bindLabel="descricao" bindValue="id" placeholder="Todos"
								[(ngModel)]="filtro.faturaStatusId" (change)="filtroStatusChange($event)"
								appendTo="body">
							</ng-select>
						</div>
						<div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 align-self-end mb-1">
							<button mat-raised-button matTooltip="Pesquisar Filtros" color="primary" type="button"
								(click)="pesquisar()">
								<mat-icon class="mt-2">search</mat-icon>
								<span class="ml-1">Pesquisar</span>
							</button>
						</div>
					</div>
				</div>
			</ng-container>
		</m-portlet>
	</div>
</div>

<!-- List -->
<m-portlet [options]="{headLarge: false}">
	<ng-container mPortletHeadTitle>
		<div class="m-portlet__head-title">
			<h3 class="m-portlet__head-text">
				<span translate="">Faturas</span>
			</h3>
		</div>
	</ng-container>
	<ng-container mPortletHeadTools>
		<button mat-raised-button matTooltip="Download do Demonstrativo" color="primary" type="button"
			(click)="downloadDemonstrativo()">
			<mat-icon>file_download</mat-icon>
			<span translate="">Download</span>
		</button>
	</ng-container>
	<ng-container mPortletBody>
		<div class="mat-table__wrapper">
			<div *ngIf="viewLoading" class="m-splash-screen d-flex p-3" style="position: relative;">
				<span>Aguarde, buscando registros na base... </span>
				<mat-spinner diameter="40"></mat-spinner>
			</div>
			<div *ngIf="!viewLoading && dataSource && dataSource.data.length === 0" class="p-2">Não foi encontrado
				registros para sua pesquisa</div>
			<mat-table class="lmat-elevation-z8" [hidden]="viewLoading || !dataSource || dataSource.data.length == 0"
				[dataSource]="dataSource" matSort matSortActive="id" matSortDirection="desc">
				<ng-container matColumnDef="id">
					<mat-header-cell *matHeaderCellDef mat-sort-header>Codigo</mat-header-cell>
					<mat-cell *matCellDef="let model">{{model.id}}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="transportador">
					<mat-header-cell *matHeaderCellDef mat-sort-header>Transportador</mat-header-cell>
					<mat-cell *matCellDef="let model">{{model.transportador.nome }}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="dataCadastro">
					<mat-header-cell *matHeaderCellDef mat-sort-header>Emissão</mat-header-cell>
					<mat-cell *matCellDef="let model">{{model.dataCadastro | date: 'dd/MM/yyyy HH:mm' }}</mat-cell>
				</ng-container>				
				<ng-container matColumnDef="quantidadeEntregas">
					<mat-header-cell *matHeaderCellDef mat-sort-header>Qtd Entregas</mat-header-cell>
					<mat-cell *matCellDef="let model">{{model.quantidadeEntrega | number: '1.0-2'}}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="valorCustoFrete">
					<mat-header-cell *matHeaderCellDef mat-sort-header>Custo do Frete</mat-header-cell>
					<mat-cell *matCellDef="let model">R$ {{model.valorCustoFrete | number: '1.2-2'}}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="valorCustoReal">
					<mat-header-cell *matHeaderCellDef mat-sort-header>Custo Real</mat-header-cell>
					<mat-cell *matCellDef="let model">R$ {{model.valorCustoReal | number: '1.2-2'}}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="qtdItensDoccob">
					<mat-header-cell *matHeaderCellDef mat-sort-header>Qtd. Doccob</mat-header-cell>
					<mat-cell *matCellDef="let model">
						<span [class.spanVermelho]="model.qtdTotalItensDoccob !== model.quantidadeEntrega">
							{{model.qtdTotalItensDoccob | number: '1.0-2'}}
						</span>
					</mat-cell>
				</ng-container>
				<ng-container matColumnDef="valorTotalDoccob">
					<mat-header-cell *matHeaderCellDef mat-sort-header>Valor Doccob</mat-header-cell>
					<mat-cell *matCellDef="let model">
						<span [class.spanVermelho]="model.valorTotalDoccob !== model.valorCustoReal" *ngIf="model.valorDocumento <= 0">
							R$ {{model.valorTotalDoccob | number: '1.2-2'}}
						</span>
						<span [class.spanVermelho]="model.valorDocumento !== model.valorCustoReal" *ngIf="model.valorDocumento > 0">
							R$ {{model.valorDocumento | number: '1.2-2'}}
						</span>
					</mat-cell>
				</ng-container>
				<ng-container matColumnDef="faturaStatusId">
					<mat-header-cell *matHeaderCellDef mat-sort-header>Status</mat-header-cell>
					<mat-cell *matCellDef="let model">
						<span [class]="model.faturaStatus.icon" aria-hidden="true" style="font-size: large;"
							[ngStyle]="{'color': model.faturaStatus.iconColor}">
						</span>
						<span class="ml-2">{{ model.faturaStatus.descricao }}</span>
					</mat-cell>
				</ng-container>

				<ng-container matColumnDef="actions">
					<mat-header-cell *matHeaderCellDef>Ações</mat-header-cell>
					<mat-cell *matCellDef="let model">
						<button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
							<mat-icon>more_vert</mat-icon>
						</button>
						<mat-menu #menu="matMenu">
							<button mat-menu-item color="primary" (click)="edit(model)">							
								<mat-icon>create</mat-icon>
								<span>Detalhe da Fatura</span>
							</button>	
							<button mat-menu-item color="primary" (click)="edit(model)">
								<mat-icon>file_upload</mat-icon>
								<span>Upload Arquivo DOCCOB</span>
							</button>
							<button mat-menu-item color="primary" (click)="detalhamento(model.id)">
								<mat-icon>list</mat-icon>
								<span>Detalhamento do Calculo</span>
							</button>
							<button mat-menu-item color="primary" (click)="exibirResultadoIntegracao(model.id)">
								<mat-icon>history</mat-icon>
								<span>Resultado Integração</span>
							</button>
						</mat-menu>
					</mat-cell>
				</ng-container>
				<mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
				<mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
			</mat-table>
			<mat-paginator [pageSizeOptions]="[20, 50, 100, 200]" showFirstLastButtons></mat-paginator>
		</div>
	</ng-container>
</m-portlet>