<div class="row">
	<div class="col-xl-12">
		<m-portlet [options]="{headLarge: false}">
			<ng-container mPortletHeadTitle>
				<div class="m-portlet__head-title">
					<h3 class="m-portlet__head-text">
						<span translate="y">Gerenciamento de Expedição | Filtros</span>
					</h3>
				</div>
			</ng-container>
			<ng-container mPortletHeadTools>
			</ng-container>
			<ng-container mPortletBody>
				<div class="filtro">
					<div class="row">
						<div class="col-xl-5">
							<label>Filial</label>
							<ng-select [items]="lstCanais" bindLabel="canalNome" bindValue="id" placeholder="Todos"
								[(ngModel)]="filtro.canalId" appendTo="body">
							</ng-select>
						</div>
						<div class="col-xl-5">
							<label>Transportador</label>
							<ng-select [items]="lstTransportadores" bindLabel="transportadorNome" bindValue="id"
								placeholder="Todos" [(ngModel)]="filtro.transportadorId" (clear)="limparComboTransportadorFilial()"
								(change)="getTransportadoresCnpj($event.id)" appendTo="body">
							</ng-select>
						</div>
					</div>
					<br/>
					<div class="row">
						<div class="col-xl-5">
							<label>Transp Filial</label>
							<ng-select [items]="lstTransportadoresFiliais" bindLabel="descricao" bindValue="id"
								placeholder="Todos" [(ngModel)]="filtro.transportadorCnpjId" appendTo="body">
							</ng-select>
						</div>
						<div class="col-xl-3">
							<label>Gera Notifis</label>
							<ng-select placeholder="Todos" [(ngModel)]="filtro.expedicaoAutomatica" appendTo="body">
								<ng-option [value]="true">Sim</ng-option>
								<ng-option [value]="false">Não</ng-option>
							</ng-select>
						</div>
						<div class="col-xl-2 col-lg-2 col-md-2 col-sm-5 align-self-end">
							<button mat-raised-button matTooltip="Pesquisar Filtros" color="primary" type="button"
								(click)="pesquisar()">
								<mat-icon class="mt-2">search</mat-icon>
								<span class="ml-1">Pesquisar</span>
							</button>
						</div>
					</div>
				</div>
			</ng-container>
		</m-portlet>
	</div>
</div>

<m-portlet [options]="{headLarge: false}">
	<ng-container mPortletHeadTitle>
		<div class="m-portlet__head-title">
			<h3 class="m-portlet__head-text">
				<span>Gerenciamento de Expedição</span>
			</h3>
		</div>
	</ng-container>
	<ng-container mPortletHeadTools>
		<button mat-raised-button matTooltip="Criar Novo Contrato" color="success" type="button" (click)="novo()">
			<span>Cadastrar Novo</span>
		</button>
	</ng-container>
	<ng-container mPortletBody>
		<div class="mat-table__wrapper">
			<div *ngIf="viewLoading" class="m-splash-screen d-flex p-3" style="position: relative;">
				<span>Aguarde, buscando registros na base... </span>
				<mat-spinner diameter="40"></mat-spinner>
			</div>
			<div *ngIf="!viewLoading && dataSource && dataSource.data.length === 0" class="p-2">
				Não foi encontrado registros para sua pesquisa
			</div>
			<mat-table [hidden]="viewLoading || !dataSource || dataSource.data.length == 0" class="lmat-elevation-z8"
				[dataSource]="dataSource" matSort matSortActive="dataCadastro" matSortDirection="asc">

				<ng-container matColumnDef="filial">
					<mat-header-cell *matHeaderCellDef>Filial</mat-header-cell>
					<mat-cell *matCellDef="let model">{{ model.canal?.nomeFantasia == null ? 'Todos' :
						model.canal.nomeFantasia }}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="transportador">
					<mat-header-cell *matHeaderCellDef>Transportadora</mat-header-cell>
					<mat-cell *matCellDef="let model">{{ model.transportador?.nomeFantasia == null ? 'Todos' :
						model.transportador.nomeFantasia }}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="transportadorFilial">
					<mat-header-cell *matHeaderCellDef>Transp. Filial</mat-header-cell>
					<mat-cell *matCellDef="let model">{{ model.transportadorCnpj?.cnpj == null ? 'Todos' :	model.transportadorCnpj.nome + ' - ' + model.transportadorCnpj.cnpj}}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="geraNotifis">
					<mat-header-cell *matHeaderCellDef>Gera Notifis</mat-header-cell>
					<mat-cell *matCellDef="let model">{{ model.expedicaoAutomatica ? 'Sim' : 'Não' }}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="prazoMinimo">
					<mat-header-cell *matHeaderCellDef>Prazo Min.</mat-header-cell>
					<mat-cell *matCellDef="let model">{{ model.prazoComercial }}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="dataCadastro">
					<mat-header-cell *matHeaderCellDef>Data Cadastro</mat-header-cell>
					<mat-cell *matCellDef="let model">{{ (model.dataCadastro | date: 'dd/MM/yyyy HH:mm') || '--'  }}</mat-cell>
				</ng-container>
				<ng-container matColumnDef="actions">
					<mat-header-cell *matHeaderCellDef>Ações</mat-header-cell>
					<mat-cell *matCellDef="let model">
						<button mat-icon-button color="primary" matTooltip="Editar"
							(click)="edit(model)"><mat-icon>create</mat-icon></button>&nbsp;
					</mat-cell>
				</ng-container>
				<mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
				<mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
			</mat-table>
			<mat-paginator [pageSizeOptions]="[5, 10, 20]" [length]="resultsLength" (page)="pageChange($event)"
				showFirstLastButtons></mat-paginator>
		</div>
	</ng-container>
</m-portlet>